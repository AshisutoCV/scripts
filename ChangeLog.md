# Changelog

## [VER=20191031b] - 2019/10/31

### 追加
#### shield-sup.sh
* 新規作成。

### 変更
#### getlog.sh
* swarm版にも対応。

#### shield-setup.sh
* UbuntuにおいてUniverseリポジトリの追加と、libssl1.1の問題に対処しました。(BugFix)
* shield-sup.sh および getlog.sh を取得するように設定。(sup/ 配下に配置。)

--------------------------------------------------------------

## [VER=20191031a] - 2019/10/31

### 変更
#### getlog.sh
* デフォルトでのTZ指定を廃止。および収集単位を10000レコードに。TZ指定した場合は100レコード単位にスイッチする。

#### shield-setup.sh
* deploy-shield.sh内のTZ指定部分のメーカーbugをケアするように対応
* ses_limit_flgが正しく指定できない問題を修正。
* UbuntuにおいてUniverseリポジトリの追加と、libssl1.1の問題に対処しました。

#### shield-start.sh
* deploy-shield.sh内のTZ指定部分のメーカーbugをケアするように対応

--------------------------------------------------------------

## [VER=20191018a] - 2019/10/18

### 変更
#### shield-setup.sh
* 他ノードでの実行コマンド表示で不要なコマンド(setup-node.sh)が表示されていたのを削除。

--------------------------------------------------------------

## [VER=20191016a] - 2019/10/16

### 変更
#### shield-update.sh
* chekc_sysctlが未呼び出しである問題を修正

--------------------------------------------------------------

## [VER=20191010a] - 2019/10/10

### 変更
#### shield-update.sh
* yamlファイルの比較で差分がまったく無い場合にエラーになる問題を修正。

--------------------------------------------------------------

## [VER=20191008a] - 2019/10/08

### 変更
#### shield-restore.sh
* 自動リストア抑止が行われるようになったbuild576以降のconsul_backupに対応。

#### shield-update.sh
* configure-sysctl-values.shの差分があった場合、他のノードでも実行するように表示。

--------------------------------------------------------------

## [VER=20191007b] - 2019/10/07

### 変更
#### shield-update.sh
* 差分確認後の再実行時、updateを実行してよいかどうかの確認を行うように修正。

--------------------------------------------------------------

## [VER=20191007a] - 2019/10/07

### 変更
#### shield-update.sh
* shield-setups.shの更新箇所にバグあり。修正対応。
* logsディレクトリが存在しない場合に作成するように修正。

#### shield-start.sh
* logsディレクトリが存在しない場合に作成するように修正。

#### shield-stop.sh
* logsディレクトリが存在しない場合に作成するように修正。

#### shield-nodes.sh
* logsディレクトリが存在しない場合に作成するように修正。

--------------------------------------------------------------

## [VER=20191003a] - 2019/10/03

### 追加
#### shield-update.sh
* yamlファイル差分のチェックを事前実施して警告。後にshieldsetup.shを呼び出すように実装。

### 変更
#### shield-setup.sh
* bonding対応
* System component が3台構成ならantiafinity:hardを有効化
* updateを別スクリプト(shield-update.sh)からのトリガーを想定するように修正
* Dockerバージョン固定の修正
* logファイルをlogディレクトリに集約

#### shield-start.sh
* logファイルをlogディレクトリに集約

#### shield-stop.sh
* logファイルをlogディレクトリに集約
* 以前のバージョンにおける不正な common の削除を判定により削除可能なよう修正(恒久対策完了)

#### shield-nodes.sh
* logファイルをlogディレクトリに集約
* Rancher Agent追加用コマンド(command.txt)を実行時に随時更新するように変更。

#### delete-all.sh
* CentOSにおいて、rancher-store ディレクトリが削除されない問題に対応
* 各種追加スクリプトやyamlなどの削除を追加

#### getlog.sh
* 複数ログ対応
* 10000件以上の出力に対応
* TZ指定による時刻変換に対応
* ファイルへの出力対応

### 移動
#### sup へ
* getlog.sh

--------------------------------------------------------------

## [VER=20190920a] - 2019/09/20

### 追加
#### shield-restore.sh
* 特定顧客向けにリストアスクリプトを作成

--------------------------------------------------------------

## [VER=20190919b] - 2019/09/19
### 変更
#### shield-stop.sh
* 以前のバージョンにおける不正な common の削除を網羅的に実施。存在しない場合のエラーを許容。(暫定対応)

--------------------------------------------------------------

## [VER=20190919a] - 2019/09/19
### 変更
#### shield-setup.sh
* updateにおいて、moveto_projectを行うように修正。

--------------------------------------------------------------

## [VER=20190823a] - 2019/09/18
### 変更
#### shield-stop.sh
* バージョン番号付与開始? (作成当時の日付をバージョンとして設定)

--------------------------------------------------------------

## [VER=20190913a] - 2019/09/13
### 変更
#### shield-setup.sh
* バージョン番号付与開始
* クラスタ作成時にlocalClusterAuthEndpointを追加。（他C/Mにkubectlを入れて代替オペ可能)
* NWをcalicoからflannelに変更
* configure-sysctl-values.shの実行タイミング変更
* clean-rancher-agent.shおよびdelete-all.shをDLしておくように設定

--------------------------------------------------------------

## [VER=20190911a] - 2019/09/11
### 変更
#### shield-start.sh
* バージョン番号付与開始
* deploy-shield.shにおけるSHIELD_REPO変数に対応。(19.09から。ビルドは564以降)
* common 対応

--------------------------------------------------------------

## [VER=20190910a] - 2019/09/10
### 追加
#### shield-nodes.sh
* バージョン番号付与開始?

--------------------------------------------------------------

## [VER=] - 2019/09/06
### 変更
#### shield-setup.sh
* deploy-shield.shにおけるSHIELD_REPO変数に対応。(19.09から。ビルドは564以降)
* NWをcalicoからflannelに変更しようとしたができておらず。
* common 対応

